"use strict";(self.webpackChunktestkube_documentation=self.webpackChunktestkube_documentation||[]).push([[5766],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),u=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=u(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,k=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return n?a.createElement(k,i(i({ref:t},l),{},{components:n})):a.createElement(k,i({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},46028:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_position:11,sidebar_label:"Container Executor"},i="What is a Container Executor?",s={unversionedId:"test-types/container-executor",id:"test-types/container-executor",title:"What is a Container Executor?",description:"The TestKube Container Executor allows you to run your own container images for executing tests. TestKube orchestrates the Tests using the container image as Kubernetes Jobs.",source:"@site/docs/4-test-types/container-executor.md",sourceDirName:"4-test-types",slug:"/test-types/container-executor",permalink:"/testkube/test-types/container-executor",draft:!1,editUrl:"https://github.com/kubeshop/testkube/docs/docs/4-test-types/container-executor.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{sidebar_position:11,sidebar_label:"Container Executor"},sidebar:"tutorialSidebar",previous:{title:"cURL",permalink:"/testkube/test-types/executor-curl"},next:{title:"Creating New Test Types",permalink:"/testkube/test-types/executor-custom"}},c={},u=[{value:"Input Data",id:"input-data",level:2},{value:"Collecting test artifacts",id:"collecting-test-artifacts",level:2}],l={toc:u};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"what-is-a-container-executor"},"What is a Container Executor?"),(0,r.kt)("p",null,"The TestKube Container Executor allows you to run your own container images for executing tests. TestKube orchestrates the Tests using the container image as Kubernetes Jobs."),(0,r.kt)("p",null,"The Test execution fails if the container exits with an error and succeeds when the container command successfully executes."),(0,r.kt)("p",null,"In order to use the Container Executor, create a new executor with ",(0,r.kt)("inlineCode",{parentName:"p"},"executor_type: container")," and your custom type. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: executor.testkube.io/v1\nkind: Executor\nmetadata:\n  name: curl-container-executor\n  namespace: testkube\nspec:\n  image: curlimages/curl:7.85.0\n  command: ["curl"]\n  executor_type: container\n  imagePullSecrets:\n    - name: secret-name\n  types:\n  - curl-container/test\n')),(0,r.kt)("p",null,"In the above example, all Tests of ",(0,r.kt)("inlineCode",{parentName:"p"},"curl-container/test")," will be executed by this Executor. Then you can create a new test that uses this Executor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: test-website\n  namespace: testkube\nspec:\n  type: curl-container/test\n  executionRequest:\n    args:\n    - https://testkube.kubeshop.io/\n    envs:\n      TESTKUBE_ENV: example\n")),(0,r.kt)("p",null,"Executing this test will run a Kubernetes Job with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"curlimages/curl:7.85.0")," image"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"secret-name")," image pull secret"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"curl")," command"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"https://testkube.kubeshop.io/")," argument")),(0,r.kt)("p",null,"You can provide image, args, command, and image pull secrets in the HTTP Request, Test Spec, and Executor spec. The container executor merges all the data using the following order:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"HTTP Request."),(0,r.kt)("li",{parentName:"ol"},"Test.Spec.ExecutionRequest fields are used if they are not filled before."),(0,r.kt)("li",{parentName:"ol"},"Executor.Spec fields are used if they are not filled before.")),(0,r.kt)("h2",{id:"input-data"},"Input Data"),(0,r.kt)("p",null,"You can provide input data via string, files, and Git repositories via TestKube Dashboard. The data is downloaded into ",(0,r.kt)("inlineCode",{parentName:"p"},"/data")," before the test is run using Kubernetes Init container. When using ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," type, the content is put into ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/test-content")," file. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: custom-container\n  namespace: testkube\nspec:\n  content:\n    data: |-\n      {\n        "project": "testkube",\n        "is": "awesome"\n      }\n    type: string\n  type: custom-container/test\n')),(0,r.kt)("p",null,"Puts data into ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/test-content")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ cat /data/test-content\n{\n  "project": "testkube",\n  "is": "awesome"\n}\n')),(0,r.kt)("p",null,"When using Git or Git directory sources, the content is placed inside ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/repo")," directory. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: custom-container\n  namespace: testkube\nspec:\n  content:\n    repository:\n      branch: main\n      type: git-dir\n      uri: https://github.com/kubeshop/testkube-executor-init\n    type: git-dir\n")),(0,r.kt)("p",null,"Downloads into ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/repo")," directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ ls /data/repO\nCODE_OF_CONDUCT.md  CONTRIBUTING.md  LICENSE  Makefile  README.md  build  cmd  go.mod  go.sum  pkg\n")),(0,r.kt)("h2",{id:"collecting-test-artifacts"},"Collecting test artifacts"),(0,r.kt)("p",null,"For container executors that produce files during test execution we support collecting (scraping) these artifacts and storing them in our S3 compatible file storage. You need to save test related files into specified directories on the dynamically created volume, they will be uploaded from there to Testkube file storage and available later for downloading using standard CLI or UI commands. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: tests.testkube.io/v3\nkind: Test\nmetadata:\n  name: custom-container\n  namespace: testkube\nspec:\n  content:\n    repository:\n      branch: main\n      type: git-dir\n      uri: https://github.com/kubeshop/testkube-executor-init\n    type: git-dir\n  executionRequest:\n    artifactRequest:\n      storageClassName: standard\n      volumeMountPath: /share\n      dirs:\n      - test/video\n      - test/reports\n")),(0,r.kt)("p",null,"You have to define the storage class name, volume mount path and directories in this volume with test artifacts.\nMake sure your container executor definition has ",(0,r.kt)("inlineCode",{parentName:"p"},"artifacts")," feature."))}p.isMDXComponent=!0}}]);